<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#cc0000" />

    <!-- Preconnect to CDNs for performance -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin />
    <link rel="preconnect" href="https://kit.fontawesome.com" crossorigin />

    <!-- Favicon - SVG with automatic light/dark mode switching -->
    <link
        rel="icon"
        type="image/svg+xml"
        href="{{ site.baseurl }}/favicon.svg"
    />
    <link
        rel="apple-touch-icon"
        sizes="180x180"
        href="/assets/img/icon/apple-touch-icon.png"
    />

    <!-- Bootstrap CSS (Updated to latest stable) -->
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
        crossorigin="anonymous"
    />

    <!-- Bootstrap Bundle with Popper (Updated) -->
    <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"
        defer
    ></script>

    <!-- Bootstrap Icons -->
    <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css"
    />

    <!-- FontAwesome Icons -->
    <script
        src="https://kit.fontawesome.com/22ab6dd597.js"
        crossorigin="anonymous"
        defer
    ></script>

    <!-- Theme Toggle Script - Load early to prevent flash -->
    <script>
        // Apply saved theme immediately (before page renders) - defaults to light
        (function () {
            const savedTheme = localStorage.getItem("theme");
            if (savedTheme === "dark") {
                document.documentElement.setAttribute("data-theme", "dark");
            }
            // Default is light mode (no attribute needed)
        })();
    </script>

    <!-- Font Size Toggle Script - Mobile only -->
    <script src="{{ site.baseurl }}/assets/js/font-toggle.js" defer></script>

    <!-- Highlight JS (Conditionally loaded) -->
    {% if page.usehighlight %}
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-light.min.css"
    />
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"
        defer
    ></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            hljs.highlightAll();
        });
    </script>
    {% endif %}

    <!-- ChartJS (Conditionally loaded) -->
    {% if page.usechartjs %}
    <script
        src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"
        defer
    ></script>
    {% endif %}

    <!-- MathJax support (Updated CDN) -->
    {% if page.usemathjax %}
    <script>
        MathJax = {
            tex: {
                inlineMath: [
                    ["$", "$"],
                    ["\\(", "\\)"],
                ],
                displayMath: [
                    ["$$", "$$"],
                    ["\\[", "\\]"],
                ],
                tags: "ams",
            },
        };
    </script>
    <script
        type="text/javascript"
        id="MathJax-script"
        async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
    ></script>
    {% endif %}

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ site.baseurl }}/assets/css/main.css" />

    <!-- SEO -->
    <title>
        {% if page.title %} {{ page.title }} {% else %} {{ site.title }} {%
        endif %}
    </title>
    <link
        rel="sitemap"
        type="application/xml"
        title="sitemap"
        href="{{ site.baseurl }}/sitemap.xml"
    />
    {% seo title=false %} {% include structured-data.html %}
</head>
